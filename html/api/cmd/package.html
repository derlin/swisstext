

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>swisstext.cmd &mdash; SwissText  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="swisstext.cmd.scraping" href="scraping/package.html" />
    <link rel="prev" title="API Overview" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> SwissText
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/installation.html#installation-on-a-linux-server">Installation on a Linux server</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/installation.html#installation-on-macos">Installation on MacOS</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/usage.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/usage.html#running-mongodb">Running MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/usage.html#running-the-frontend">Running the frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/usage.html#running-the-backend">Running the backend</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/confs.html">Configuration options</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/confs.html#current-best-pipeline-configuration">Current ?best? pipeline configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/confs.html#using-default-tools">Using default tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../getting-started/confs.html#using-extra-tools">Using extra tools</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../getting-started/confs.html#tool-dependencies">Tool dependencies</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">API Overview</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">swisstext.cmd</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#module-swisstext.cmd.base_config">Configuration files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#module-swisstext.cmd.link_utils">Link utilities</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dealing-with-links-in-a-page">Dealing with links in a page</a></li>
<li class="toctree-l4"><a class="reference internal" href="#dealing-with-search-results">Dealing with search results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="scraping/package.html">swisstext.cmd.scraping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="scraping/package.html#st-scrape">st_scrape</a><ul>
<li class="toctree-l4"><a class="reference internal" href="scraping/package.html#st-scrape-dump-config">dump_config</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/package.html#st-scrape-from-file">from_file</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/package.html#st-scrape-from-mongo">from_mongo</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/package.html#st-scrape-gen-seeds">gen_seeds</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="scraping/tool-interfaces.html">Tool interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="scraping/tool-implementations.html">Tool implementations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="scraping/tool-implementations.html#module-swisstext.cmd.scraping.tools.basic_decider">Deciders</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/tool-implementations.html#module-swisstext.cmd.scraping.tools.basic_seed_creator">Seed creators</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/tool-implementations.html#module-swisstext.cmd.scraping.tools.bs_crawler">Crawlers</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/tool-implementations.html#module-swisstext.cmd.scraping.tools.norm_punc">Normalizers</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/tool-implementations.html#module-swisstext.cmd.scraping.tools.punkt_splitter">Splitters</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/tool-implementations.html#module-swisstext.cmd.scraping.tools.pattern_sentence_filter">Sentence Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/tool-implementations.html#link-filters">Link Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/tool-implementations.html#module-swisstext.cmd.scraping.tools.swigspot_langid">Language Detectors</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/tool-implementations.html#module-swisstext.cmd.scraping.tools.console_saver">Savers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="scraping/pipeline-implementation.html">Pipeline implementation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="scraping/pipeline-implementation.html#module-swisstext.cmd.scraping.config">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/pipeline-implementation.html#module-swisstext.cmd.scraping.data">Data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/pipeline-implementation.html#module-swisstext.cmd.scraping.page_queue">Queue</a></li>
<li class="toctree-l4"><a class="reference internal" href="scraping/pipeline-implementation.html#module-swisstext.cmd.scraping.pipeline">Pipeline</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="searching/package.html">swisstext.cmd.searching</a><ul>
<li class="toctree-l3"><a class="reference internal" href="searching/package.html#st-search">st_search</a><ul>
<li class="toctree-l4"><a class="reference internal" href="searching/package.html#st-search-dump-config">dump_config</a></li>
<li class="toctree-l4"><a class="reference internal" href="searching/package.html#st-search-from-file">from_file</a></li>
<li class="toctree-l4"><a class="reference internal" href="searching/package.html#st-search-from-mongo">from_mongo</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="searching/tool-interfaces.html">Tool interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="searching/tool-implementations.html">Tool implementations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="searching/tool-implementations.html#module-swisstext.cmd.searching.tools.console_saver">Savers</a></li>
<li class="toctree-l4"><a class="reference internal" href="searching/tool-implementations.html#module-swisstext.cmd.searching.tools.google_search">Searchers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="searching/pipeline-implementation.html">Pipeline implementation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="searching/pipeline-implementation.html#module-swisstext.cmd.searching.config">Configuration</a></li>
<li class="toctree-l4"><a class="reference internal" href="searching/pipeline-implementation.html#module-swisstext.cmd.searching.data">Data structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="searching/pipeline-implementation.html#module-swisstext.cmd.searching.pipeline">Search engine</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../mongo/package.html">swisstext.mongo</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../mongo/package.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mongo/package.html#collections">Collections</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mongo/package.html#about-the-code">About the code</a></li>
<li class="toctree-l3"><a class="reference internal" href="../mongo/definitions.html">Abstract Definitions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../mongo/definitions.html#module-swisstext.mongo.abstract.generic">Common structures and embedded documents</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mongo/definitions.html#module-swisstext.mongo.abstract.seeds">Seed collection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mongo/definitions.html#module-swisstext.mongo.abstract.sentences">Sentences collection</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mongo/definitions.html#module-swisstext.mongo.abstract.urls">URLs and Blacklist collections</a></li>
<li class="toctree-l4"><a class="reference internal" href="../mongo/definitions.html#module-swisstext.mongo.abstract.users">Users collection</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../mongo/definitions.html#module-swisstext.mongo.models">MongoEngine-ready classes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../alswiki/package.html">swisstext.alswiki</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../alswiki/package.html#st-alswiki">st_alswiki</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../alswiki/package.html#st-alswiki-download">download</a></li>
<li class="toctree-l4"><a class="reference internal" href="../alswiki/package.html#st-alswiki-parse">parse</a></li>
<li class="toctree-l4"><a class="reference internal" href="../alswiki/package.html#st-alswiki-process">process</a></li>
<li class="toctree-l4"><a class="reference internal" href="../alswiki/package.html#st-alswiki-txt">txt</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../alswiki/package.html#processing-alswiki-dumps">Processing Alswiki dumps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../alswiki/package.html#processing-text-files">Processing text files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../todos.html">TODOs</a></li>
</ul>
<p class="caption"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../ideas.html">Ideas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ideas.html#sentence-filtering">Sentence Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ideas.html#url-filtering">URL Filtering</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutthedoc.html">About this documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../aboutthedoc.html#generation">Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../aboutthedoc.html#deploying-on-github-pages">Deploying on github-pages</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">SwissText</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">API Overview</a> &raquo;</li>
        
      <li>swisstext.cmd</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/derlin/swisstext/blob/master/docs/api/cmd/package.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-swisstext.cmd">
<span id="swisstext-cmd"></span><h1>swisstext.cmd<a class="headerlink" href="#module-swisstext.cmd" title="Permalink to this headline">¶</a></h1>
<p>This package contains everything for running the SwissText Scraping logic.</p>
<p>It is implemented using two command-line programs, each in its own package:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">st_scrape</span></code> defined in <a class="reference internal" href="scraping/package.html#module-swisstext.cmd.scraping" title="swisstext.cmd.scraping"><code class="xref py py-mod docutils literal notranslate"><span class="pre">swisstext.cmd.scraping</span></code></a>, is used to scrape URLs and detect/save Swiss German sentences,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">st_search</span></code> defined in <a class="reference internal" href="searching/package.html#module-swisstext.cmd.searching" title="swisstext.cmd.searching"><code class="xref py py-mod docutils literal notranslate"><span class="pre">swisstext.cmd.searching</span></code></a>, is used to do submit search queries using seeds and gather
new URLs to scrape</p></li>
</ul>
<p>After installing the package, here is an example use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## To use this script, create a directory and create the following files:</span>
<span class="c1">##  * configuration files: searching.yaml and scraping.yaml (see the doc)</span>
<span class="c1">##  * bootstrap files: base_seeds.txt, one seed per line to start with</span>

<span class="nb">set</span> -e
<span class="nb">trap</span> <span class="nb">exit</span> SIGINT

<span class="nv">base_dir</span><span class="o">=</span>.  <span class="c1"># relative link to the base directory</span>

<span class="nv">st_search</span><span class="o">=</span><span class="s2">&quot;st_search -c </span><span class="nv">$base_dir</span><span class="s2">/searching.yaml&quot;</span>
<span class="nv">st_scrape</span><span class="o">=</span><span class="s2">&quot;st_scrape -c </span><span class="nv">$base_dir</span><span class="s2">/scraping.yaml&quot;</span>

<span class="c1"># search for the bootstrap seeds</span>
<span class="nv">$st_search</span> from_file <span class="nv">$base_dir</span>/base_seeds.txt

<span class="c1"># do five loops. Each loop: (a) scrapes the new URLs, (b) generates random seeds, (c) use the new seeds</span>
<span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> <span class="m">5</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span>
    <span class="nb">echo</span> <span class="s2">&quot;======= START LOOP&quot;</span>
    <span class="c1"># scrape at most 30 new urls</span>
    <span class="nv">$st_scrape</span> --no-seed from_mongo --new -n <span class="m">30</span>
    <span class="nb">echo</span> <span class="s2">&quot;======= generating SEEDS&quot;</span>
    <span class="c1"># generate three random seeds, each time from 150 randomly picked sentences</span>
    <span class="nv">$st_scrape</span> gen_seeds -s <span class="m">150</span> -n <span class="m">1</span>
    <span class="nv">$st_scrape</span> gen_seeds -s <span class="m">150</span> -n <span class="m">1</span>
    <span class="nv">$st_scrape</span> gen_seeds -s <span class="m">150</span> -n <span class="m">1</span>
    <span class="nb">echo</span> <span class="s2">&quot;======= searching SEEDS&quot;</span>
    <span class="c1"># search URLs using the newly generated seeds</span>
    <span class="nv">$st_search</span> from_mongo --new -n <span class="m">3</span>
<span class="k">done</span>
</pre></div>
</div>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>add pipeline schema</p>
</div>
<div class="section" id="module-swisstext.cmd.base_config">
<span id="configuration-files"></span><h2>Configuration files<a class="headerlink" href="#module-swisstext.cmd.base_config" title="Permalink to this headline">¶</a></h2>
<p>This module encapsulates all the configuration needed to run a multi-steps toolchain.
It is used by both commandline tools.</p>
<p>Config objects can easily be populated from a YAML configuration file. This file should have the following structure:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># This entry defines general options that will be stored in :py:attr:`BaseConfig.options`.</span>
<span class="nt">options</span><span class="p">:</span>
  <span class="nt">key1</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">value1</span>

<span class="c1"># This entry defines tools to instantiate</span>
<span class="c1"># the actual name is specified in the subclass by overriding :py:attr:`BaseConfig.tool_entry_name`</span>
<span class="c1"># valid interface names are specified in the sublcass by overriding :py:attr:`valid_tool_entries`</span>
<span class="nt">tool_entry_name</span><span class="p">:</span>
    <span class="c1"># optional default package for relative entries</span>
    <span class="nt">_base_package</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">some.default.module</span>
    <span class="c1"># list of tools</span>
    <span class="nt">interface_name_1</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">absolute.module.ToolClassName1</span>
    <span class="nt">interface_name_2</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.ToolClassName2</span> <span class="c1"># will be expanded to some.default.module.ToolClassName2</span>

<span class="c1"># any entry in the form [interface_name]_options defines options that will be passed to the</span>
<span class="c1"># tool class upon construction. Here, for example, the actual instantiation will be:</span>
<span class="c1">#    absolute.module.ToolClassName1(param_1=some_value, param_X=some_other_value)</span>
<span class="nt">interface_name_1_options</span><span class="p">:</span>
    <span class="nt">param_1</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">some_value</span>
    <span class="nt">param_X</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">some_other_value</span>
</pre></div>
</div>
<dl class="class">
<dt id="swisstext.cmd.base_config.BaseConfig">
<em class="property">class </em><code class="sig-prename descclassname">swisstext.cmd.base_config.</code><code class="sig-name descname">BaseConfig</code><span class="sig-paren">(</span><em class="sig-param">default_config_path: str</em>, <em class="sig-param">option_class: classmethod = &lt;class 'dict'&gt;</em>, <em class="sig-param">config: Union[str</em>, <em class="sig-param">dict</em>, <em class="sig-param">io.IOBase] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/swisstext/cmd/base_config.html#BaseConfig"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#swisstext.cmd.base_config.BaseConfig" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/abc.html#abc.ABC" title="(in Python v3.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABC</span></code></a></p>
<p>This class encapsulates the configuration options of a toolchain. It is able to load options from YAML files
and also to instantiate tools from a dictionary of module+class names.</p>
<dl class="attribute">
<dt id="swisstext.cmd.base_config.BaseConfig.INTERFACE_WILDCARD">
<code class="sig-name descname">INTERFACE_WILDCARD</code><em class="property"> = '_I_'</em><a class="headerlink" href="#swisstext.cmd.base_config.BaseConfig.INTERFACE_WILDCARD" title="Permalink to this definition">¶</a></dt>
<dd><p>if this is used, try to instantiate the interface of the tool</p>
</dd></dl>

<dl class="method">
<dt id="swisstext.cmd.base_config.BaseConfig.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param">default_config_path: str</em>, <em class="sig-param">option_class: classmethod = &lt;class 'dict'&gt;</em>, <em class="sig-param">config: Union[str</em>, <em class="sig-param">dict</em>, <em class="sig-param">io.IOBase] = None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/swisstext/cmd/base_config.html#BaseConfig.__init__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#swisstext.cmd.base_config.BaseConfig.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a configuration.</p>
<p>Subclasses should provide the path to a default configuration (YAML file) and optionally an
option class to hold general options. The config is provided by the user and can be a file, a path
to a file or even a dictionary (as long as it has the correct structure).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>default_config_path</strong> – the absolute path to a default configuration file.</p></li>
<li><p><strong>option_class</strong> – the class to use for holding global options (a dictionary by default).</p></li>
<li><p><strong>config</strong> – user configuration that overrides the default options. config can be either a path or a
file object of a YAML configuration, or a dictionary</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.8)"><strong>ValueError</strong></a> – if config is not of a supported type</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="swisstext.cmd.base_config.BaseConfig.dumps">
<code class="sig-name descname">dumps</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/swisstext/cmd/base_config.html#BaseConfig.dumps"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#swisstext.cmd.base_config.BaseConfig.dumps" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="swisstext.cmd.base_config.BaseConfig.get">
<code class="sig-name descname">get</code><span class="sig-paren">(</span><em class="sig-param">prop_name</em>, <em class="sig-param">default=None</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/swisstext/cmd/base_config.html#BaseConfig.get"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#swisstext.cmd.base_config.BaseConfig.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a value from the YAML configuration file. This method supports paths with “.”, for example:</p>
<ul class="simple">
<li><p><cite>options</cite>: returns the top-level “options”</p></li>
<li><p><cite>tool_entry.tool_name</cite>: return the value of tool_name under tool_entry</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>prop_name</strong> – the path of the property to retrieve</p></li>
<li><p><strong>default</strong> – the default value if the property is not found</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the property value or <cite>default</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="swisstext.cmd.base_config.BaseConfig.instantiate_tools">
<code class="sig-name descname">instantiate_tools</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; List[object]<a class="reference internal" href="../../_modules/swisstext/cmd/base_config.html#BaseConfig.instantiate_tools"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#swisstext.cmd.base_config.BaseConfig.instantiate_tools" title="Permalink to this definition">¶</a></dt>
<dd><p>For each <a class="reference internal" href="#swisstext.cmd.base_config.BaseConfig.valid_tool_entries" title="swisstext.cmd.base_config.BaseConfig.valid_tool_entries"><code class="xref py py-attr docutils literal notranslate"><span class="pre">valid_tool_entries</span></code></a> under <a class="reference internal" href="#swisstext.cmd.base_config.BaseConfig.tool_entry_name" title="swisstext.cmd.base_config.BaseConfig.tool_entry_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">tool_entry_name</span></code></a>, try to create an instance.
In case a tool is not defined and <a class="reference internal" href="#swisstext.cmd.base_config.BaseConfig.interfaces_package" title="swisstext.cmd.base_config.BaseConfig.interfaces_package"><code class="xref py py-attr docutils literal notranslate"><span class="pre">interfaces_package</span></code></a> is not None or the value is
<a class="reference internal" href="#swisstext.cmd.base_config.BaseConfig.INTERFACE_WILDCARD" title="swisstext.cmd.base_config.BaseConfig.INTERFACE_WILDCARD"><code class="xref py py-attr docutils literal notranslate"><span class="pre">INTERFACE_WILDCARD</span></code></a> it will try to instantiate the tool name interface instead.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>a list of tool instances, in the same order as <a class="reference internal" href="#swisstext.cmd.base_config.BaseConfig.interfaces_package" title="swisstext.cmd.base_config.BaseConfig.interfaces_package"><code class="xref py py-attr docutils literal notranslate"><span class="pre">interfaces_package</span></code></a></p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.8)"><strong>RuntimeError</strong></a> – if a tool could not be instantiated</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="swisstext.cmd.base_config.BaseConfig.interfaces_package">
<em class="property">abstract property </em><code class="sig-name descname">interfaces_package</code><a class="headerlink" href="#swisstext.cmd.base_config.BaseConfig.interfaces_package" title="Permalink to this definition">¶</a></dt>
<dd><p>Should return the complete package where the interfaces are defined, if any.
In case this is defined and a tool is missing from the list, we will try to instantiate
the interface instead.</p>
</dd></dl>

<dl class="method">
<dt id="swisstext.cmd.base_config.BaseConfig.merge_dicts">
<em class="property">classmethod </em><code class="sig-name descname">merge_dicts</code><span class="sig-paren">(</span><em class="sig-param">default</em>, <em class="sig-param">overrides</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/swisstext/cmd/base_config.html#BaseConfig.merge_dicts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#swisstext.cmd.base_config.BaseConfig.merge_dicts" title="Permalink to this definition">¶</a></dt>
<dd><p>Merge <code class="docutils literal notranslate"><span class="pre">override</span></code> into <code class="docutils literal notranslate"><span class="pre">default</span></code> recursively.
As the names suggest, if an entry is defined in both, the value in <code class="docutils literal notranslate"><span class="pre">overrides</span></code> takes precedence.</p>
</dd></dl>

<dl class="method">
<dt id="swisstext.cmd.base_config.BaseConfig.set">
<code class="sig-name descname">set</code><span class="sig-paren">(</span><em class="sig-param">prop_name</em>, <em class="sig-param">value</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/swisstext/cmd/base_config.html#BaseConfig.set"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#swisstext.cmd.base_config.BaseConfig.set" title="Permalink to this definition">¶</a></dt>
<dd><p>Set a value using the property dot syntax. See <a class="reference internal" href="#swisstext.cmd.base_config.BaseConfig.get" title="swisstext.cmd.base_config.BaseConfig.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> to see how it works.</p>
</dd></dl>

<dl class="method">
<dt id="swisstext.cmd.base_config.BaseConfig.tool_entry_name">
<em class="property">abstract property </em><code class="sig-name descname">tool_entry_name</code><a class="headerlink" href="#swisstext.cmd.base_config.BaseConfig.tool_entry_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Should return the name of the tool_entries option, i.e. the YAML path to the dictionary of
[interface name, canonical class to instantiate].</p>
</dd></dl>

<dl class="method">
<dt id="swisstext.cmd.base_config.BaseConfig.valid_tool_entries">
<em class="property">abstract property </em><code class="sig-name descname">valid_tool_entries</code><a class="headerlink" href="#swisstext.cmd.base_config.BaseConfig.valid_tool_entries" title="Permalink to this definition">¶</a></dt>
<dd><p>Should return the list of valid tool entries under the <a class="reference internal" href="#swisstext.cmd.base_config.BaseConfig.tool_entry_name" title="swisstext.cmd.base_config.BaseConfig.tool_entry_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">tool_entry_name</span></code></a>.
Note that the order of tools in the list defines the order of tools instances returned by
<a class="reference internal" href="#swisstext.cmd.base_config.BaseConfig.instantiate_tools" title="swisstext.cmd.base_config.BaseConfig.instantiate_tools"><code class="xref py py-meth docutils literal notranslate"><span class="pre">instantiate_tools()</span></code></a>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-swisstext.cmd.link_utils">
<span id="link-utilities"></span><h2>Link utilities<a class="headerlink" href="#module-swisstext.cmd.link_utils" title="Permalink to this headline">¶</a></h2>
<p>This module provides utilities to deal with links.</p>
<div class="section" id="dealing-with-links-in-a-page">
<h3>Dealing with links in a page<a class="headerlink" href="#dealing-with-links-in-a-page" title="Permalink to this headline">¶</a></h3>
<p>By simply extracting all the <code class="docutils literal notranslate"><span class="pre">href</span></code> attributes in a HTML page, we might end up with a rather large list of
children, not all of them interesting to crawl. Indded, this list would probably contain:</p>
<ul class="simple">
<li><p>duplicates (or different links pointing to the same page but another anchor),</p></li>
<li><p>anchors,</p></li>
<li><p>javascript (<code class="docutils literal notranslate"><span class="pre">javascript:</span></code>),</p></li>
<li><p>pointers to images, PDFs or other non-text resources,</p></li>
<li><p>etc.</p></li>
</ul>
<p>As every implementation of <a class="reference internal" href="scraping/tool-interfaces.html#swisstext.cmd.scraping.interfaces.ICrawler" title="swisstext.cmd.scraping.interfaces.ICrawler"><code class="xref py py-class docutils literal notranslate"><span class="pre">swisstext.cmd.scraping.interfaces.ICrawler</span></code></a> has to do the job of filtering
this list, we might as well provide a general way to do so.</p>
</div>
<div class="section" id="dealing-with-search-results">
<h3>Dealing with search results<a class="headerlink" href="#dealing-with-search-results" title="Permalink to this headline">¶</a></h3>
<p>When querying Google or another search engine for results, returned URLs might point to PDFs, videos or other
uninteresting websites. The <a class="reference internal" href="#swisstext.cmd.link_utils.fix_url" title="swisstext.cmd.link_utils.fix_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fix_url()</span></code></a> method is here to help normalize URLs and filtering out those “bad” results.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For the stability of the whole system, it is primordial for <strong>all URLs</strong> to pass through this module before
being added to the persistance layer (e.g. Mongo Database).</p>
</div>
<dl class="data">
<dt id="swisstext.cmd.link_utils.EXCLUDED_TLDS">
<code class="sig-prename descclassname">swisstext.cmd.link_utils.</code><code class="sig-name descname">EXCLUDED_TLDS</code><em class="property"> = {'ac': True, 'ad': True, 'ae': True, 'af': True, 'ag': True, 'ai': True, 'al': True, 'am': True, 'an': True, 'ao': True, 'aq': True, 'ar': True, 'as': True, 'at': True, 'au': True, 'aw': True, 'ax': True, 'az': True, 'ba': True, 'bb': True, 'bd': True, 'be': True, 'bf': True, 'bg': True, 'bh': True, 'bi': True, 'bj': True, 'bl': True, 'bm': True, 'bn': True, 'bo': True, 'bq': True, 'br': True, 'bs': True, 'bt': True, 'bv': True, 'bw': True, 'by': True, 'bz': True, 'ca': True, 'cat': True, 'cc': True, 'cd': True, 'cf': True, 'cg': True, 'ci': True, 'ck': True, 'cl': True, 'cm': True, 'cn': True, 'co': True, 'cr': True, 'cu': True, 'cv': True, 'cw': True, 'cx': True, 'cy': True, 'cz': True, 'dj': True, 'dk': True, 'dm': True, 'do': True, 'dz': True, 'ec': True, 'ee': True, 'eg': True, 'eh': True, 'er': True, 'es': True, 'et': True, 'eus': True, 'fi': True, 'fj': True, 'fk': True, 'fm': True, 'fo': True, 'ga': True, 'gal': True, 'gd': True, 'ge': True, 'gf': True, 'gg': True, 'gh': True, 'gi': True, 'gl': True, 'gm': True, 'gn': True, 'gp': True, 'gq': True, 'gr': True, 'gs': True, 'gt': True, 'gu': True, 'gw': True, 'gy': True, 'hk': True, 'hm': True, 'hn': True, 'hr': True, 'ht': True, 'hu': True, 'id': True, 'ie': True, 'il': True, 'im': True, 'in': True, 'io': True, 'iq': True, 'ir': True, 'is': True, 'je': True, 'jm': True, 'jo': True, 'jp': True, 'ke': True, 'kg': True, 'kh': True, 'ki': True, 'km': True, 'kn': True, 'kp': True, 'kr': True, 'kw': True, 'ky': True, 'kz': True, 'la': True, 'lb': True, 'lc': True, 'li': True, 'lk': True, 'lr': True, 'ls': True, 'lt': True, 'lu': True, 'lv': True, 'ly': True, 'ma': True, 'mc': True, 'md': True, 'me': True, 'mf': True, 'mg': True, 'mh': True, 'mk': True, 'ml': True, 'mm': True, 'mn': True, 'mo': True, 'mp': True, 'mq': True, 'mr': True, 'ms': True, 'mt': True, 'mu': True, 'mv': True, 'mw': True, 'mx': True, 'my': True, 'mz': True, 'na': True, 'nc': True, 'ne': True, 'nf': True, 'ng': True, 'ni': True, 'nl': True, 'no': True, 'np': True, 'nr': True, 'nu': True, 'nz': True, 'om': True, 'pa': True, 'pe': True, 'pf': True, 'pg': True, 'ph': True, 'pk': True, 'pl': True, 'pm': True, 'pn': True, 'pr': True, 'ps': True, 'pt': True, 'pw': True, 'py': True, 'qa': True, 're': True, 'ro': True, 'rs': True, 'ru': True, 'rw': True, 'sa': True, 'sb': True, 'sc': True, 'sd': True, 'se': True, 'sg': True, 'sh': True, 'si': True, 'sj': True, 'sk': True, 'sl': True, 'sm': True, 'sn': True, 'so': True, 'sr': True, 'ss': True, 'st': True, 'sv': True, 'sx': True, 'sy': True, 'sz': True, 'tc': True, 'td': True, 'tf': True, 'tg': True, 'th': True, 'tj': True, 'tk': True, 'tl': True, 'tm': True, 'tn': True, 'to': True, 'tp': True, 'tr': True, 'tt': True, 'tv': True, 'tw': True, 'tz': True, 'ua': True, 'ug': True, 'uy': True, 'uz': True, 'va': True, 'vc': True, 've': True, 'vg': True, 'vi': True, 'vn': True, 'vu': True, 'wf': True, 'ws': True, 'ye': True, 'yt': True, 'za': True, 'zm': True, 'zw': True}</em><a class="headerlink" href="#swisstext.cmd.link_utils.EXCLUDED_TLDS" title="Permalink to this definition">¶</a></dt>
<dd><p>Quick lookup dictionary to exclude URLs from any country code TLDs except a rare list of pertinent ones (.ch, .eu, .de …).
See <a class="reference external" href="https://gist.github.com/derlin/421d2bb55018a1538271227ff6b1299d">this gist</a> for the source of the list.</p>
</dd></dl>

<dl class="data">
<dt id="swisstext.cmd.link_utils.INCLUDED_WIKI_DOMAINS">
<code class="sig-prename descclassname">swisstext.cmd.link_utils.</code><code class="sig-name descname">INCLUDED_WIKI_DOMAINS</code><em class="property"> = {}</em><a class="headerlink" href="#swisstext.cmd.link_utils.INCLUDED_WIKI_DOMAINS" title="Permalink to this definition">¶</a></dt>
<dd><p>Quick lookup dictionary to exclude any URL from wikipedia, except the ones from the given subdomains.
See <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_Wikipedias">https://en.wikipedia.org/wiki/List_of_Wikipedias</a> for a full list of wikipedia subdomains.</p>
</dd></dl>

<dl class="function">
<dt id="swisstext.cmd.link_utils.filter_links">
<code class="sig-prename descclassname">swisstext.cmd.link_utils.</code><code class="sig-name descname">filter_links</code><span class="sig-paren">(</span><em class="sig-param">base_url: str, links: Iterable[str]</em><span class="sig-paren">)</span> &#x2192; Generator[str, None, None]<a class="reference internal" href="../../_modules/swisstext/cmd/link_utils.html#filter_links"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#swisstext.cmd.link_utils.filter_links" title="Permalink to this definition">¶</a></dt>
<dd><p>Resolve, clean and filter links found in a page. By links we mean here any value of <cite>href</cite> attribute found
in a page. This is especially useful for the
<code class="xref py py-class docutils literal notranslate"><span class="pre">swisstext.cmd.scraping.interface.ICrawler</span></code> to constitute and populate the crawl results’s
<code class="xref py py-attr docutils literal notranslate"><span class="pre">links</span></code> attribute.</p>
<p>In addition to what <a class="reference internal" href="#swisstext.cmd.link_utils.fix_url" title="swisstext.cmd.link_utils.fix_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">fix_url()</span></code></a> does, this method will also exclude:</p>
<ul class="simple">
<li><p>the base URL</p></li>
<li><p>Duplicates</p></li>
</ul>
<p>For two links to be considered duplicates, they need to match exactly. Exceptions are anchors (stripped
automatically) and trailing slashes (in this case, the first encountered link will be returned).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">swisstext.cmd.link_utils</span> <span class="kn">import</span> <span class="n">filter_links</span>
<span class="n">base_url</span> <span class="o">=</span> <span class="s1">&#39;http://example.ch/page/1&#39;</span>
<span class="n">hrefs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;#&#39;</span><span class="p">,</span>
    <span class="s2">&quot;whatsapp://send?text=Dumoulin verlangt naar&quot;</span><span class="p">,</span>
    <span class="s1">&#39;../other/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;../other#anchor&#39;</span><span class="p">,</span>
    <span class="s1">&#39;?page=2&amp;q=isch&#39;</span><span class="p">,</span>
    <span class="s1">&#39;?page=2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https://imgur.org/some-image.png&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https://ru.wikipedia.org/wiki&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https://als.wikipedia.org&#39;</span><span class="p">,</span>
    <span class="s1">&#39;http://other.resource.test&#39;</span><span class="p">,</span>
    <span class="s1">&#39;javascript:return false&#39;</span><span class="p">,</span>
    <span class="s1">&#39;?p=66383&amp;sid=aaece0dfd1e47e08505dcb5fae2d3f03&#39;</span><span class="p">,</span>

    <span class="s1">&#39;http://www.twitter.com/some-hashtag?lang=en-gb&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https://twitter.com/share?text=blabla&#39;</span><span class="p">,</span>

    <span class="s1">&#39;http://zh-cn.facebook.com/XXXX&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https://facebook.com/&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https://www.facebook.com&#39;</span><span class="p">,</span>
    <span class="s1">&#39;https://graph.facebook.com&#39;</span>
<span class="p">]</span>
<span class="n">links</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filter_links</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">hrefs</span><span class="p">))</span>

<span class="c1"># links contain:</span>
<span class="c1">#  http://example.ch/other/</span>
<span class="c1">#  http://example.ch/page/1?page=2&amp;q=isch</span>
<span class="c1">#  http://example.ch/page/1?page=2</span>
<span class="c1">#  http://other.resource.test</span>
<span class="c1">#  http://example.ch/page/1?p=66383</span>
<span class="c1">#  https://twitter.com/some-hashtag</span>
<span class="c1">#  https://www.facebook.com/XXXX</span>
<span class="c1">#  https://www.facebook.com/</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>base_url</strong> – the URL of the current page (not returned and used to resolve relative links). Use ‘’ to ignore.</p></li>
<li><p><strong>links</strong> – a list of links found, relative or absolute</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a generator of unique absolute URLs, all beginning with <cite>http</cite></p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="swisstext.cmd.link_utils.fix_url">
<code class="sig-prename descclassname">swisstext.cmd.link_utils.</code><code class="sig-name descname">fix_url</code><span class="sig-paren">(</span><em class="sig-param">url: str</em>, <em class="sig-param">base_url: str = None) -&gt; (&lt;class 'str'&gt;</em>, <em class="sig-param">&lt;class 'bool'&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/swisstext/cmd/link_utils.html#fix_url"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#swisstext.cmd.link_utils.fix_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Fix/normalize and URL and decide if it is interesting to crawl.</p>
<p>The URL is potentially transformed by:</p>
<blockquote>
<div><ul class="simple">
<li><p>resolving relative to absolute URLs (only if base_url is set)</p></li>
<li><p>removing potential sid query parameters (Magento)</p></li>
<li><p>removing anchors</p></li>
</ul>
</div></blockquote>
<p>The “is interesting” decision will exclude:</p>
<blockquote>
<div><ul class="simple">
<li><p>relative URLs (so ensure to provide a base_url if the url is relative)</p></li>
<li><p>non HTTP links (<cite>mailto:</cite>, <cite>javascript:</cite>, anchors, …)</p></li>
<li><p>URLs pointing to non text resources (see <code class="xref py py-const docutils literal notranslate"><span class="pre">EXCLUDED_EXTENSIONS</span></code>)</p></li>
<li><p>URLs with a Country Code TLD unlikely to contain Swiss German (see <code class="xref py py-const docutils literal notranslate"><span class="pre">EXCLUDED_EXTENSIONS</span></code>)</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> – the url</p></li>
<li><p><strong>base_url</strong> – the base url, required if the url is a relative one</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a tuple (fixed_url, is_interesting)</p>
</dd>
</dl>
</dd></dl>

</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="scraping/package.html" class="btn btn-neutral float-right" title="swisstext.cmd.scraping" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../index.html" class="btn btn-neutral float-left" title="API Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Lucy Linder

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>